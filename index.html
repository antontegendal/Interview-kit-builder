<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ETG Interview Kit Builder</title>
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    .animate-spin {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, createElement: h } = React;

    // Simple icon components
    const AlertCircle = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('circle', { cx: 12, cy: 12, r: 10 }),
      h('line', { x1: 12, y1: 8, x2: 12, y2: 12 }),
      h('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 })
    );

    const CheckCircle = ({ size = 20 }) => h('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('path', { d: 'M22 11.08V12a10 10 0 1 1-5.93-9.14' }),
      h('polyline', { points: '22 4 12 14.01 9 11.01' })
    );

    const Loader = ({ size = 20, className = '' }) => h('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, className },
      h('line', { x1: 12, y1: 2, x2: 12, y2: 6 }),
      h('line', { x1: 12, y1: 18, x2: 12, y2: 22 }),
      h('line', { x1: 4.93, y1: 4.93, x2: 7.76, y2: 7.76 }),
      h('line', { x1: 16.24, y1: 16.24, x2: 19.07, y2: 19.07 }),
      h('line', { x1: 2, y1: 12, x2: 6, y2: 12 }),
      h('line', { x1: 18, y1: 12, x2: 22, y2: 12 }),
      h('line', { x1: 4.93, y1: 19.07, x2: 7.76, y2: 16.24 }),
      h('line', { x1: 16.24, y1: 7.76, x2: 19.07, y2: 4.93 })
    );

    const Download = ({ size = 20 }) => h('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
      h('polyline', { points: '7 10 12 15 17 10' }),
      h('line', { x1: 12, y1: 15, x2: 12, y2: 3 })
    );

    const Upload = ({ size = 20, className = '' }) => h('svg', { width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, className },
      h('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
      h('polyline', { points: '17 8 12 3 7 8' }),
      h('line', { x1: 12, y1: 3, x2: 12, y2: 15 })
    );

    const FileText = () => h('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('path', { d: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z' }),
      h('polyline', { points: '14 2 14 8 20 8' }),
      h('line', { x1: 16, y1: 13, x2: 8, y2: 13 }),
      h('line', { x1: 16, y1: 17, x2: 8, y2: 17 }),
      h('polyline', { points: '10 9 9 9 8 9' })
    );

    const Target = () => h('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('circle', { cx: 12, cy: 12, r: 10 }),
      h('circle', { cx: 12, cy: 12, r: 6 }),
      h('circle', { cx: 12, cy: 12, r: 2 })
    );

    const Users = () => h('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
      h('path', { d: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2' }),
      h('circle', { cx: 9, cy: 7, r: 4 }),
      h('path', { d: 'M23 21v-2a4 4 0 0 0-3-3.87' }),
      h('path', { d: 'M16 3.13a4 4 0 0 1 0 7.75' })
    );

    const InterviewKitBuilder = () => {
      const [step, setStep] = useState(1);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      
      const [jobDescription, setJobDescription] = useState('');
      const [roleLevel, setRoleLevel] = useState('');
      const [interviewStages, setInterviewStages] = useState([
        { id: 1, name: 'Stage 1', interviewers: [{ id: 1, name: '' }] }
      ]);
      
      const [jobAnalysis, setJobAnalysis] = useState(null);
      const [competencyMap, setCompetencyMap] = useState(null);
      const [generatedQuestions, setGeneratedQuestions] = useState(null);
      const [finalKits, setFinalKits] = useState(null);
      
      const [expandedInterviewers, setExpandedInterviewers] = useState({});

      const companyValues = `ETG Company Values:

1. Playing to Win
We know we can be #1 in the industry.
Our ambition motivates us to improve ourselves continuously, and we are ready to walk the extra mile. In this exciting ride, we are here to make an impact in our customers', partners', and our own lives while having fun doing it.

2. Sense of Urgency to be Excellent
In a rapidly changing industry we embrace the change, knowing fast decisions and implementation are necessary to succeed. At the same time good is not good enough for us - we relentlessly work to improve quality to the benefit of our customers.

3. Accountability and Cooperation
We thrive in a culture of diligence, trust and mutual respect. We have a solid personal ownership of our tasks, but at the same time, as a high-performing team, we use each other's strengths to reach our common goal. After all, we play as a team; we win as a team!`;

      const leadershipValues = `ETG Leadership Principles:

1. Role Model Corporate Culture
   - "Actions speak louder than words"
   - Know, communicate, repeat, live the values

2. Be Interested, Reachable and Approachable
   - Be communicative and open
   - Actively communicate with team and seek opportunities to influence
   - Secure you are an "easy to go to person"

3. Continuous Constructive Feedback
   - Be fair and relevant
   - Use positive reinforcement
   - Be distinct about expectations

4. Courage to Make Decisions and Be Distinct
   - To not make a decision is to make a decision of inaction
   - Be a changemaker of improvements
   - Be distinct in your communication and ensure individual actions towards objectives

5. Dare to Be Yourself, Dare to Ask for Help
   - Be yourself
   - Combine honesty and professionalism
   - To ask for help is a sign of strength and commitment

6. Team Development & Group Dynamics
   - Know and respect your fellow team members
   - Provide the leadership and conditions your individual team member needs to excel in the corporate culture
   - Actively build a high performing team
   - Implement Hybrid Model
   - Make and take efforts so all geographies are involved

7. Cross Department Cooperation
   - Encourage and support cross department cooperation
   - Speak well of your fellow leaders/teams from other departments
   - We are a "non corporate politics environment" and have no tolerance for personal prestige`;

      const roleLevels = [
        { value: 'F', label: 'Level F - Associate', useLeadership: false },
        { value: 'E', label: 'Level E - Professional', useLeadership: false },
        { value: 'D', label: 'Level D - Team Leader / Senior Professional', useLeadership: false },
        { value: 'C', label: 'Level C - Management', useLeadership: true },
        { value: 'B', label: 'Level B - Senior Management', useLeadership: true },
        { value: 'A3', label: 'Level A3 - Function Head', useLeadership: true },
        { value: 'A2', label: 'Level A2 - Department Head', useLeadership: true }
      ];

      const selectedLevelData = roleLevels.find(level => level.value === roleLevel);

      const handleJobDescriptionFileUpload = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        setLoading(true);
        setError('');

        try {
          const fileExtension = file.name.split('.').pop().toLowerCase();
          
          if (fileExtension === 'pdf') {
            const base64Data = await new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = () => {
                const base64 = reader.result.split(",")[1];
                resolve(base64);
              };
              reader.onerror = () => reject(new Error("Failed to read file"));
              reader.readAsDataURL(file);
            });

            const response = await fetch("https://api.anthropic.com/v1/messages", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                model: "claude-sonnet-4-20250514",
                max_tokens: 4000,
                messages: [
                  {
                    role: "user",
                    content: [
                      {
                        type: "document",
                        source: {
                          type: "base64",
                          media_type: "application/pdf",
                          data: base64Data,
                        },
                      },
                      {
                        type: "text",
                        text: "Extract all text content from this job description PDF. Return only the text content, without any additional commentary or formatting.",
                      },
                    ],
                  },
                ],
              })
            });

            if (!response.ok) {
              throw new Error(`Failed to extract PDF text: ${response.status}`);
            }

            const data = await response.json();
            const extractedText = data.content[0].text;
            setJobDescription(extractedText);

          } else if (fileExtension === 'docx' || fileExtension === 'doc') {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({ arrayBuffer });
            setJobDescription(result.value);
          } else {
            throw new Error('Unsupported file format. Please upload PDF or Word documents.');
          }
        } catch (err) {
          setError(`Error reading file: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const toggleInterviewerExpansion = (stageIdx, intIdx) => {
        const key = `${stageIdx}-${intIdx}`;
        setExpandedInterviewers(prev => ({
          ...prev,
          [key]: !prev[key]
        }));
      };

      const addInterviewer = (stageId) => {
        setInterviewStages(stages =>
          stages.map(stage =>
            stage.id === stageId
              ? {
                  ...stage,
                  interviewers: [
                    ...stage.interviewers,
                    { id: Date.now(), name: '' }
                  ]
                }
              : stage
          )
        );
      };

      const updateInterviewerName = (stageId, interviewerId, name) => {
        setInterviewStages(stages =>
          stages.map(stage =>
            stage.id === stageId
              ? {
                  ...stage,
                  interviewers: stage.interviewers.map(interviewer =>
                    interviewer.id === interviewerId
                      ? { ...interviewer, name }
                      : interviewer
                  )
                }
              : stage
          )
        );
      };

      const addStage = () => {
        setInterviewStages([
          ...interviewStages,
          {
            id: Date.now(),
            name: `Stage ${interviewStages.length + 1}`,
            interviewers: [{ id: Date.now(), name: '' }]
          }
        ]);
      };

      const removeStage = (stageId) => {
        if (interviewStages.length > 1) {
          setInterviewStages(stages => stages.filter(stage => stage.id !== stageId));
        }
      };

      const removeInterviewer = (stageId, interviewerId) => {
        setInterviewStages(stages =>
          stages.map(stage =>
            stage.id === stageId
              ? {
                  ...stage,
                  interviewers: stage.interviewers.filter(
                    interviewer => interviewer.id !== interviewerId
                  )
                }
              : stage
          )
        );
      };

      const runJobAnalysis = async () => {
        setLoading(true);
        setError('');
        
        try {
          const response = await fetch("https://api.anthropic.com/v1/messages", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "claude-sonnet-4-20250514",
              max_tokens: 4000,
              messages: [
                {
                  role: "user",
                  content: `You are an expert talent acquisition analyst. Analyze the provided job description and extract structured information.

CONTEXT:
- Focus on competencies that can be assessed through behavioral interviews
- Consider the role level and its implications for assessment depth
- Role Level: ${selectedLevelData.label}

JOB DESCRIPTION:
${jobDescription}

OUTPUT REQUIREMENTS:
Provide a JSON response with:
1. role_title: string
2. role_level: "${roleLevel}"
3. core_competencies: array of 5-8 key competencies
4. technical_skills: array of hard skills required
5. key_responsibilities: array of 3-5 main responsibilities
6. team_context: string describing team dynamics and collaboration needs
7. requires_leadership_values: ${selectedLevelData.useLeadership}

CRITICAL: 
- Extract only what's explicitly stated or clearly implied.
- Your ENTIRE response must be ONLY valid JSON. DO NOT include any text, explanations, or markdown outside the JSON object.
- DO NOT wrap the JSON in markdown code blocks or backticks.`
                }
              ]
            })
          });

          if (!response.ok) {
            throw new Error(`API request failed: ${response.status}`);
          }

          const data = await response.json();
          let responseText = data.content[0].text;
          
          responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
          
          const analysisData = JSON.parse(responseText);
          setJobAnalysis(analysisData);
          setStep(2);
        } catch (err) {
          setError(`Job Analysis Error: ${err.message}`);
          console.error(err);
        } finally {
          setLoading(false);
        }
      };

      // Simplified version - continuing in next message due to length
      
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
          <div className="max-w-5xl mx-auto">
            <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
              <h1 className="text-4xl font-bold text-gray-900 mb-2">
                ETG Interview Kit Builder
              </h1>
              <p className="text-gray-600">
                AI-powered tool to create structured, value-aligned interview kits
              </p>
            </div>

            {error && (
              <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start gap-3">
                <AlertCircle />
                <div className="flex-1">
                  <h3 className="font-semibold text-red-900">Error</h3>
                  <p className="text-red-700 text-sm">{error}</p>
                </div>
              </div>
            )}

            <div className="bg-white rounded-lg shadow-lg p-8">
              <div className="text-center py-12">
                <p className="text-gray-600 mb-4">Testing deployment...</p>
                <p className="text-sm text-gray-500">If you see this, the page is loading correctly!</p>
                <p className="text-sm text-gray-500 mt-2">Role Level selector and full functionality coming up...</p>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<InterviewKitBuilder />);
      });
    } else {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<InterviewKitBuilder />);
    }
  </script>
</body>
</html>